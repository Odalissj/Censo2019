<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Resultados Censo 2018 – El Progreso | Odalis Mariandré Arana Marroquín – 1890-22-7585</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="../css/bootstrap-icons.css" rel="stylesheet" />
    <link href="../content/Estilo1.css" rel="stylesheet" />
  </head>
  <body>
    <div>
      <img src="../images/Censo.png" alt="Encabezado Odalis Arana" class="img-fluid w-100"/>
    </div>
    <header class="topbar py-3">
      <div class="container d-flex justify-content-between align-items-center">
        <div class="brand">Portal de Resultados del Censo 2018</div>
        <div class="text-end">
          <div class="fw-semibold">
            Odalis Mariandré Arana Marroquín – 1890-22-7585
          </div>
        </div>
      </div>
    </header>

    <section class="nav-lite py-3 border-bottom border-dark-subtle">
      <div class="container">
        <div class="row g-3 align-items-end">
          <div class="col-12 col-lg-4">
            <label class="form-label m-0">División Geográfica</label>
            <select id="selDivision" class="form-select">
              <option value="999">Departamento de El Progreso (Resumen)</option>
              <option value="201">Guastatoya</option>
              <option value="202">Morazán</option>
              <option value="203">San Agustín Acasaguastlán</option>
              <option value="204">San Cristóbal Acasaguastlán</option>
              <option value="205">El Jícaro</option>
              <option value="206">Sansare</option>
              <option value="207">Sanarate</option>
              <option value="208">San Antonio La Paz</option>
            </select>
          </div>
          <div class="col-12 col-lg-8">
            <div class="d-flex gap-2">
              <button id="btnInicio" class="btn">INICIO</button>
              <button class="btn disabled">RESULTADOS</button>
              <button class="btn disabled">GRÁFICOS</button>
              <button class="btn disabled">INDICADORES</button>
              <button class="btn disabled">PROYECCIONES</button>
              <button class="btn disabled">BASE DE DATOS</button>
              <button class="btn disabled">DOCUMENTACIÓN</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="py-4">
      <div class="container">
        <h3 class="mb-2">
          Resultados –
          <span id="tituloDivision">Departamento de El Progreso</span>
        </h3>
        <div class="muted">Totales</div>
        <div class="row g-3 mt-2">
          <div class="col-12 col-md-4">
            <div class="panel p-3">
              <div class="small muted">Total población</div>
              <div class="display-6" id="totPoblacion">—</div>
            </div>
          </div>
          <div class="col-6 col-md-4">
            <div class="panel p-3">
              <div class="small muted">Total hombres</div>
              <div class="fs-2" id="totHombres">—</div>
            </div>
          </div>
          <div class="col-6 col-md-4">
            <div class="panel p-3">
              <div class="small muted">Total mujeres</div>
              <div class="fs-2" id="totMujeres">—</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <main class="container pb-4">
      <div class="row g-4">
        <div class="col-12 col-lg-8">
          <div class="panel p-3">
            <h5 class="mb-3">Mapa temático</h5>
            <div
              class="mapbox d-flex align-items-center justify-content-center"
            >
              <div class="text-center">
                <div class="fw-semibold text-dark">
                </div>
                <div class="text-secondary">
                </div>
              </div>
            </div>
            <div class="small mt-2 muted">
            </div>
          </div>
        </div>

        <div class="col-12 col-lg-4 right-col">
          <div class="panel p-3 h-100">
            <h5 class="mb-3">Departamentos</h5>
            <div class="mb-2">
              <span class="muted">Nombre:</span>
              <span id="nombreDivision">El Progreso</span>
            </div>
            <div class="mb-2">
              <span class="muted">Capital:</span>
              <span id="capitalDivision">—</span>
            </div>
            <div class="mb-2">
              <span class="muted">Población:</span>
              <span id="poblacionPanel">—</span> <span class="muted">hab</span>
            </div>

            <hr class="border-light" />

            <h6 class="mb-2">Personas</h6>
            <div class="d-flex justify-content-between">
              <span>Índice de Masculinidad</span
              ><span class="badge badge-ind" id="indiceMasculinidad">—</span>
            </div>
            <div class="d-flex justify-content-between">
              <span>Edad promedio</span
              ><span class="badge badge-ind" id="edadPromedio">—</span>
            </div>
            <div class="d-flex justify-content-between">
              <span>Índice de Dependencia</span
              ><span class="badge badge-ind" id="indiceDependencia">—</span>
            </div>
            <div class="d-flex justify-content-between">
              <span>Años promedio de estudio</span
              ><span class="badge badge-ind" id="aniosPromedio">—</span>
            </div>
            <div class="d-flex justify-content-between">
              <span>Alfabetismo</span
              ><span class="badge badge-ind" id="alfabetismo">—</span>
            </div>

            <img
              class="mascota"
              alt="mascota"
              src="../images/muneco.png"
            />
          </div>
        </div>
      </div>
    </main>

    <section class="container pb-5">
      <div class="row g-4">
        <div class="col-12 col-lg-6">
          <div class="panel p-3">
            <h5 class="mb-3">Población por sexo</h5>
            <table class="table table-darkish table-striped align-middle">
              <thead class="thead-mini">
                <tr>
                  <th>Sexo</th>
                  <th class="text-end">Absoluto</th>
                  <th class="text-end">% del total</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Hombres</td>
                  <td class="text-end" id="sexoHombresAbs">—</td>
                  <td class="text-end" id="sexoHombresPct">—</td>
                </tr>
                <tr>
                  <td>Mujeres</td>
                  <td class="text-end" id="sexoMujeresAbs">—</td>
                  <td class="text-end" id="sexoMujeresPct">—</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="col-12 col-lg-6">
          <div class="panel p-3">
            <h5 class="mb-3">Población por área</h5>
            <table class="table table-darkish table-striped align-middle">
              <thead class="thead-mini">
                <tr>
                  <th>Área</th>
                  <th class="text-end">Absoluto</th>
                  <th class="text-end">% del total</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Urbana</td>
                  <td class="text-end" id="urbanaAbs">—</td>
                  <td class="text-end" id="urbanaPct">—</td>
                </tr>
                <tr>
                  <td>Rural</td>
                  <td class="text-end" id="ruralAbs">—</td>
                  <td class="text-end" id="ruralPct">—</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="col-12">
          <div class="panel p-3">
            <h5 class="mb-3">Población por grandes grupos de edad</h5>
            <table class="table table-darkish table-striped align-middle">
              <thead class="thead-mini">
                <tr>
                  <th>Grupo</th>
                  <th class="text-end">Absoluto</th>
                  <th class="text-end">% del total</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>0–14 años</td>
                  <td class="text-end" id="edad014Abs">—</td>
                  <td class="text-end" id="edad014Pct">—</td>
                </tr>
                <tr>
                  <td>15–64 años</td>
                  <td class="text-end" id="edad1564Abs">—</td>
                  <td class="text-end" id="edad1564Pct">—</td>
                </tr>
                <tr>
                  <td>65 y más años</td>
                  <td class="text-end" id="edad65Abs">—</td>
                  <td class="text-end" id="edad65Pct">—</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="col-12">
          <div class="panel p-3">
            <h5 class="mb-3">Población por pueblos</h5>
            <table class="table table-darkish table-striped align-middle">
              <thead class="thead-mini">
                <tr>
                  <th>Pueblo</th>
                  <th class="text-end">Absoluto</th>
                  <th class="text-end">% del total</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Maya</td>
                  <td class="text-end" id="puebloMayaAbs">—</td>
                  <td class="text-end" id="puebloMayaPct">—</td>
                </tr>
                <tr>
                  <td>Garífuna</td>
                  <td class="text-end" id="puebloGarifunaAbs">—</td>
                  <td class="text-end" id="puebloGarifunaPct">—</td>
                </tr>
                <tr>
                  <td>Xinka</td>
                  <td class="text-end" id="puebloXinkaAbs">—</td>
                  <td class="text-end" id="puebloXinkaPct">—</td>
                </tr>
                <tr>
                  <td>Afrodescendiente/Creole/Afromestizo</td>
                  <td class="text-end" id="puebloAfroAbs">—</td>
                  <td class="text-end" id="puebloAfroPct">—</td>
                </tr>
                <tr>
                  <td>Ladino</td>
                  <td class="text-end" id="puebloLadinoAbs">—</td>
                  <td class="text-end" id="puebloLadinoPct">—</td>
                </tr>
                <tr>
                  <td>Extranjero</td>
                  <td class="text-end" id="puebloExtranjeroAbs">—</td>
                  <td class="text-end" id="puebloExtranjeroPct">—</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <footer class="footer py-4 text-center border-top border-dark">
      <div class="bg-1">
        <img src="../images/Censo.png" alt="Pie Odalis Arana" class="img-fluid w-100" />
      </div>
    </footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const sel = document.getElementById("selDivision");


  const num = v => typeof v === "number" ? v : Number(String(v ?? "").replace(/\s/g,"").replace(/,/g,"."));
  const fmt = n => Number.isFinite(n) ? new Intl.NumberFormat("es-GT").format(n) : "—";
  const pct = n => Number.isFinite(n) ? n.toFixed(2) + "%" : "—";
  const $  = id => document.getElementById(id);
  const fill = (id, val) => { const el = $(id); if (el) el.textContent = val; };

  async function fetchCenso(codigo){
    const target = `https://censopoblacion.azurewebsites.net/API/indicadores/2/${encodeURIComponent(codigo)}`;
    const urls = [
      `https://api.allorigins.win/raw?url=${encodeURIComponent(target)}`,
      `https://thingproxy.freeboard.io/fetch/${encodeURIComponent(target)}`
    ];
    for (const u of urls) {
      try {
        const r = await fetch(u, { cache: "no-store" });
        if (!r.ok) throw new Error("HTTP " + r.status);
        const text = await r.text();


        let data = JSON.parse(text);

        if (typeof data === "string") data = JSON.parse(data);
        return data;
      } catch (e) {
        console.warn("Fallo usando", u, e);
      }
    }
    throw new Error("No se pudo obtener datos (proxies caídos o bloqueados).");
  }

  function render(obj){

    const nombre = sel.selectedOptions[0].textContent.replace("(Resumen)","").trim();
    fill("tituloDivision", nombre);
    fill("nombreDivision", nombre);
    fill("capitalDivision", obj.capital ?? "—");


    const total   = num(obj.pob_total);
    const hombres = num(obj.total_sexo_hombre);
    const mujeres = num(obj.total_sexo_mujeres);
    fill("totPoblacion", fmt(total));
    fill("totHombres",   fmt(hombres));
    fill("totMujeres",   fmt(mujeres));
    fill("poblacionPanel", fmt(total));

    fill("indiceMasculinidad", obj.indice_masculinidad ?? "—");
    fill("edadPromedio",       obj.edad_promedio ?? "—");
    fill("indiceDependencia",  obj.indice_dependencia ?? "—");
    fill("aniosPromedio",      obj.anios_prom_estudio ?? "—");
    fill("alfabetismo",        obj.alfabetismo ?? "—");

    fill("sexoHombresAbs", fmt(hombres));
    fill("sexoMujeresAbs", fmt(mujeres));
    fill("sexoHombresPct", pct(num(obj.porc_sexo_hombre)));
    fill("sexoMujeresPct", pct(num(obj.porc_sexo_mujeres)));

    const urb = num(obj.total_sector_urbano);
    const rur = num(obj.total_sector_rural);
    fill("urbanaAbs", fmt(urb));
    fill("ruralAbs",  fmt(rur));
    fill("urbanaPct", pct(num(obj.porc_sector_urbano)));
    fill("ruralPct",  pct(num(obj.porc_sector_rural)));

    fill("edad014Abs",  fmt(num(obj.pob_edad_014)));
    fill("edad1564Abs", fmt(num(obj.pob_edad_1564)));
    fill("edad65Abs",   fmt(num(obj.pob_edad_65)));
    fill("edad014Pct",  pct(num(obj.porc_edad_014)));
    fill("edad1564Pct", pct(num(obj.porc_edad_1564)));
    fill("edad65Pct",   pct(num(obj.porc_edad_65)));

    fill("puebloMayaAbs",        fmt(num(obj.pob_pueblo_maya)));
    fill("puebloMayaPct",        pct(num(obj.porc_pueblo_maya)));
    fill("puebloGarifunaAbs",    fmt(num(obj.pob_pueblo_garifuna)));
    fill("puebloGarifunaPct",    pct(num(obj.porc_pueblo_garifuna)));
    fill("puebloXinkaAbs",       fmt(num(obj.pob_pueblo_xinca)));
    fill("puebloXinkaPct",       pct(num(obj.porc_pueblo_xinca)));
    fill("puebloAfroAbs",        fmt(num(obj.pob_pueblo_afrodescendiente)));
    fill("puebloAfroPct",        pct(num(obj.porc_pueblo_afrodescendiente)));
    fill("puebloLadinoAbs",      fmt(num(obj.pob_pueblo_ladino)));
    fill("puebloLadinoPct",      pct(num(obj.porc_pueblo_ladino)));
    fill("puebloExtranjeroAbs",  fmt(num(obj.pob_pueblo_extranjero)));
    fill("puebloExtranjeroPct",  pct(num(obj.porc_pueblo_extranjero)));
  }

  function showMsg(text, type="danger"){
    const c = document.querySelector(".container");
    if (!c) return;
    const div = document.createElement("div");
    div.className = `alert alert-${type} mt-3`;
    div.textContent = text;
    c.prepend(div);
    setTimeout(()=>div.remove(), 5000);
  }

  async function cargar(codigo){

    ["totPoblacion","totHombres","totMujeres","poblacionPanel"].forEach(id=>fill(id,"…"));
    try{
      const data = await fetchCenso(codigo);
      render(data);
    }catch(e){
      console.error(e);
      showMsg("No se pudo cargar la información. Intenta nuevamente.");
    }
  }

  sel.addEventListener("change", e => cargar(e.target.value));
  cargar("999");
});
</script>




  </body>
</html>
